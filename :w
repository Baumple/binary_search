#include <stdlib.h>
#include <stdio.h>
#include <stdbool.h>
#include <stdint.h>
#include <string.h>

#include "array_list.c"
#include "book.c"

void print_array(int* arr, int start, int len) {
  printf("[ ");
  for (int i = start; i < len; i++) {
    if (i == (len - 1)) {
      printf("%d", arr[i]);
    } else {
      printf("%d, ", arr[i]);
    }
  }
  printf(" ]\n");
}

/// returns -1 if it could not find the element
int binary_search(int* haystack, int needle, int start, int end) {
  if ((end - start) < 1) {
    return -1;
  }

  int middle = start + ((end - start) / 2);
  int value = haystack[middle];

  if (value == needle) {
    return middle;
  } else if (needle > value) {
    return binary_search(haystack, needle, middle + 1 , end);
  } else if (needle < value) {
    return binary_search(haystack, needle, start, middle);
  } else {
    return -1;
  }
}

enum {
  SearchTitle = 1,
  SearchAuthor = 2,
  SearchISBN = 3
};

int main(int argc, char *argv[])
{
  srand(1);
  Array arr;
  init_array(&arr, sizeof(Book));
  Book value1 = {
    .author = "A",
    .title = "B", 
    .isbn = rand(), 
  };
  Book value2 =  {
    .author = "C",
    .title = "A",
    .isbn = rand(),
  };
  Book value3 = {
    .author = "B",
    .title = "C",
    .isbn = rand(),
  };

  add_array(&arr, &value1);
  add_array(&arr, &value2);
  add_array(&arr, &value3);

  int res;
  char input[50];

  printf("Search by title (1), author(2) or isbn(3)?\n");
  
  fgets(input, sizeof(input), stdin);
  int answer = atoi(input);

  switch (answer) {
    case SearchTitle:
      // sort array for binary search
      each_array(&arr, print_book_voidptr);
      // read title into memory
      printf("Enter input (50 chars):\n");
      fgets(input, sizeof(input), stdin);
      printf("input = '%s'\n", input);

      // search array for input
      res = search_array(&arr, (void*) input, compare_book_title_s);
      printf("%d\n", res);
      break;
    case SearchAuthor:
      sort_array(&arr, compare_book_author);
      printf("Enter input: (50 chars):\n");
      fgets(input, sizeof(input), stdin);
      break;
    case SearchISBN:
      sort_array(&arr, compare_book_isbn);
      break;
    default:
      printf("Bruh, not an option!\n");
  }

  free_array(&arr);

  return EXIT_SUCCESS;
}
